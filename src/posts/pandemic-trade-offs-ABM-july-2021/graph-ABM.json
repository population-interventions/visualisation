{
	"$schema": "https://vega.github.io/schema/vega/v5.json",
	"padding": 0,
	"width": 600,
	"height": 500,

	"title": {
		"text": "Simulated COVID-19 infection numbers",
		"subtitle": "100 runs of the model, coloured by restriction stage."
	},

	"data": [
		{
			"name": "main",
			"format": {"type": "csv", "parse": "auto"},
			"url": { "signal": "DataFileName" },
			"transform": [
				{ "type": "extent", "field": "nc", "signal": "Extent" }
			]
		},
		{
			"name": "annotations",
			"values": [
				{ "event": "Borders open", "startDay": 364 }
			]
		}
	],

	"uom": {
		"minWidth": 900,
		"figPosition": "outset-4",
		"increaseMargin": 2,
		"dataDownload": {
			"href": "/posts/pandemic-trade-offs-ABM-july-2021/data-ABM-full-tidy.zip",
			"size": "12.8 MB"
		},
		"toggleGroups": [
			{
				"name": "Government & Public Response",
				"toggles": [
					{
						"title": "Vaccine Uptake",
						"description": "Percentage of people who accept vaccination when they are offered it.",
						"detailLink": "/pandemic-trade-offs-detail-july-2021/",
						"type": "select",
						"options": [
							{ "value": 50, "label": "50%" },
							{ "value": 60, "label": "60%"},
							{ "value": 70, "label": "70%", "default": true },
							{ "value": 80, "label": "80%" },
							{ "value": 90, "label": "90%" }
						],
						"signalName": "VaccineUptake"
					},
					{
						"title": "Strategy",
						"description": "Short, medium, and long term strategies employed to mitigate the spread of COVID-19 <br> (< 6 mths / 6-12 mths / 12+ mths)",
						"detailLink": "/pandemic-trade-offs-detail-july-2021/",
						"type": "select",
						"options": [
							{ "value": "ME_ME_TS", "label": "Elimination / Elimination / Tight", "default": true },
							{ "value": "ME_TS_LS", "label": "Elimination / Tight / Loose" },
							{ "value": "ME_TS_BS", "label": "Elimination / Tight / Barely Suppress" }
						],
						"signalName": "Strategy"
					},
					{
						"title": "Infected Arrivals per day",
						"description": "Average number of vaccinated yet infected people arriving in Australia per day, after borders open",
						"detailLink": "/pandemic-trade-offs-detail-july-2021/#arrivals",
						"type": "select",
						"options": [
							{ "value": 0.2, "label": "0.2 per day", "default": true },
							{ "value": 1, "label": "1 per day" },
							{ "value": 5, "label": "5 per day" },
							{ "value": 25, "label": "25 per day" }
						],
						"signalName": "VaccArrivals"
					},
					{
						"title": "Vaccinate Children",
						"description": "Whether children are vaccinated alongside adults",
						"detailLink": "/pandemic-trade-offs-detail-july-2021/",
						"type": "select",
						"options": [
							{ "value": "No", "label": "No"},
							{ "value": "Yes", "label": "Yes", "default": true }
						],
						"signalName": "VaccKids"
					},
					{
						"title": "Virus Reproduction Rate (R0)",
						"description": "Average number of people each infected person infects with no interventions, such as masks, physical distancing, case isolation, and vaccination.",
						"detailLink": "/pandemic-trade-offs-detail-july-2021/",
						"type": "select",
						"options": [
							{ "value": 5, "label": "5.0", "default": true },
							{ "value": 6, "label": "6.0" }
						],
						"signalName": "R0"
					}
				]
			}
		]
	},

	"signals": [
		{
			"name": "MaxHeight", "value": "depend on data",
			"bind": {
				"input": "select",
				"name": "Set maximum height to",
				"options": ["depend on data", 20, 50, 100, 200, 500, 1000, 2000, 4000, 6500, 12500],
				"element": "#graph-settings-ABM"
			}
		},
		{
			"name": "VerticalScale", "value": true,
			"bind": {
				"input": "select",
				"name": "Scale type:",
				"options": [1, 0.45],
				"labels": ["Linear", "Non-Linear"],
				"element": "#graph-settings-ABM"
			}
		},
		{
			"name": "VerticalScaleBins",
			"update": "VerticalScale == 0.45 ? [0,1,5,10,25,50,100,250,500,1000,2500,5000] : null"
		},

		{
			"name": "DataFileName",
			"value": "/posts/pandemic-trade-offs-ABM-v2/data-ABM/70_Yes_ME_ME_TS_4833_032.csv",
			"update": "'/posts/pandemic-trade-offs-ABM-v2/data-ABM/' + VaccineUptake + '_' + VaccKids + '_' + Strategy + '_' + replace(toString(R0), '.', '') + '_' + replace(toString(VaccArrivals), '.', '') + '.csv'"
		}
	],

	"scales": [
		{
			"name": "x",
			"type": "linear",
			"range": "width",
			"domain": [0, 104]
		},
		{
			"name": "y",
			"type": "pow",
			"range": "height",
			"domain": { "signal": "MaxHeight === 'depend on data' ? [Extent[0], Extent[1]*1.1] : [0,toNumber(MaxHeight)]" },
			"exponent": { "signal": "VerticalScale" },
			"bins": { "signal": "VerticalScaleBins" }
		},
		{
			"name": "colour",
			"type": "ordinal",
			"domain": ["1", "1b", "2", "3", "4"],
			"range": { "scheme": "turbo" },
			"range": ["#2c7bb6", "#abd9e9", "#ffe669", "#fdae61", "#d7191c"]
		},
		{
			"name": "parameters",
			"type": "ordinal",
			"domain": ["Input 1", "Input 2", "Input 3"],
			"domain": { "signal": "['Vaccine Uptake: ' + VaccineUptake, 'Vaccinate Kids: ' + VaccKids, 'Strategy: ' + Strategy, 'Infected Arrivals: ' + VaccArrivals, 'R_0: ' + R0]"},
			"range": ["#ffffff", "#ffffff", "#ffffff", "#ffffff", "#ffffff", "#ffffff"]
		}
	],

	"legends": [
		{
			"direction": "vertical",
			"fill": "colour",
			"title": "Stages",
			"orient": "bottom"
		},
		{
			"fill": "parameters",
			"labelLimit": 250,
			"title": "Parameters",
			"titleFontSize": 18,
			"titlePadding": 10,
			"symbolSize": 0,
			"rowPadding": 3,
			"padding": 15,
			"fillColor": "#f2f5f9",
			"orient": "bottom",
			"cornerRadius": 5,
			"encode": {
				"labels": {
					"enter": {
						"dx": {"value": -24},
						"fontSize": {"value": 14},
						"font": {"value": "monospace"}
					}
				}
			}
		}
	],

	"axes": [
		{
			"orient": "bottom",
			"scale": "x",
			"title": "Weeks since start of simulation",
			"titleY": 50,
			"zindex": 100
		},
		{
			"orient": "left",
			"scale": "y",
			"title": "New infections each day (7-day average)",
			"titleX": -50,
			"zindex": 100
		}
	],

	"marks": [
		{
			"type": "rule",
			"from": { "data": "annotations" },
			"encode": {
				"enter": {
					"x": {"scale": "x", "signal": "datum.startDay / 7"},
					"x2": {"scale": "x", "signal": "datum.startDay / 7"},
					"y": {"scale": "y", "value": 0},
					"y2": {"signal": "range('y')[1]"},
					"strokeOpacity": {"signal": "datum.startDay > 0 ? .1 : 0"},
					"strokeWidth": {"value": 1},
					"stroke": {"value": "#012a58"}
				}
			}
		},
		{
			"type": "text",
			"from": { "data": "annotations" },
			"encode": {
				"enter": {
					"x": {"scale": "x", "signal": "datum.startDay / 7"},
					"y": {"signal": "range('y')[1]"},
					"text": {"signal": "datum.event"},
					"baseline": {"value": "top"},
					"dx": {"value": 7.5},
					"fill": {"value": "#012a58"}
				}
			}
		},
		{
			"type": "group",
			"from": {
				"facet": {
					"name": "series",
					"data": "main",
					"groupby": ["tr", "stg", "id"]
				}
			},
			"marks": [
				{
					"type": "line",
					"from": {"data": "series"},
					"zindex": 0,
					"encode": {
						"enter": {
							"x": {"scale": "x", "field": "wk"},
							"y": {"scale": "y", "field": "nc"},
							"stroke": {"scale": "colour", "field": "stg"},
							"strokeWidth": {"value": 1},
							"strokeOpacity": {"value": 0.8},
							"defined": { "signal": "datum.nc < domain('y')[1]" }
						},
						"update": {
							"y": {"scale": "y", "field": "nc"},
							"stroke": {"scale": "colour", "field": "stg"},
							"defined": { "signal": "datum.nc < domain('y')[1]" }
						}
					}
				}
			]
		}
	]
}
