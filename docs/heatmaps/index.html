 <!DOCTYPE html>
<html lang="en" class="no-js">
<head>
	
	<meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
	
	<title>
        
Heatmap Demo | Population Interventions Unit 
    </title>
	
	<link rel="stylesheet" href="https://dds-gen3.web.unimelb.edu.au/v8.1.6/uom.css">
	<script src="https://dds-gen3.web.unimelb.edu.au/v8.1.6/uom.js"></script>

	<script
		src="https://code.jquery.com/jquery-3.5.1.min.js"
		integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
		crossorigin="anonymous"></script>

	<!-- Styling -->
	<link rel="stylesheet" href="/css/main.css">

	<!-- Global site tag (gtag.js) - Google Analytics -->
	<script async src="https://www.googletagmanager.com/gtag/js?id=G-T7QD9R9ZDF"></script>
	<script>
		window.dataLayer = window.dataLayer || [];
		function gtag(){dataLayer.push(arguments);}
		gtag('js', new Date());

		gtag('config', 'G-T7QD9R9ZDF');
	</script>
	

	   
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-color@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-interpolate@3"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-scale-chromatic@3"></script>
  
<script
    src="https://code.jquery.com/jquery-3.6.0.slim.min.js"
    integrity="sha256-u7e5khyithlIdTpu22PHhENmPcRdFiHRjhAuHcs05RI="
    crossorigin="anonymous"
></script>

<script type="text/javascript">
    function loadCSS(path) {
        let file = document.createElement("link");
        file.setAttribute("rel", "stylesheet");
        file.setAttribute("type", "text/css");
        file.setAttribute("href", path);
        document.head.appendChild(file);
    }

    var graphs = [];
</script>


<meta name="robots" content="noindex" />
<meta name="googlebot" content="noindex" />
 

</head>

<body>

	<div class="uomcontent">
		<div class="page-inner">

			<ol class="page-local-history" itemscope="" itemtype="http://schema.org/BreadcrumbList">
				<li class="root" itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
					<a href="/" title="Population Interventions Unit" itemprop="item">
						<span itemprop="name">Population Interventions Unit</span>
					</a>
					<meta content="1" itemprop="position" />
				</li>
				
<li
    class="root"
    itemprop="itemListElement"
    itemscope=""
    itemtype="http://schema.org/ListItem"
>
    <a href="/" title="Example" itemprop="item">
        <span itemprop="name">Example</span>
    </a>
    <meta content="2" itemprop="position" />
</li>
<li
    class="root"
    itemprop="itemListElement"
    itemscope=""
    itemtype="http://schema.org/ListItem"
>
    <a
        href="/heatmaps"
        title="Heatmap Demo"
        itemprop="item"
    >
        <span itemprop="name">Heatmap Demo</span>
    </a>
    <meta content="3" itemprop="position" />
</li>

			</ol>


			<div role="main">

				<div class="headerless"></div>

				 
<div class="flash flash--warning flash--center">
    <p><strong>This page is a draft.</strong> All content is provisional.</p>
</div>
 

<div class="jumpnav"></div>




<h1 class="aligned-title">Heatmap Demo</h1>


<section class="lead left">
    <p>This page is a demonstration of how to generate HTML table heatmaps using d3.</p>
</section>


<div class="fig outset-4 more-margin-2" id="fig-container-heatmap">
	<table id="fig-heatmap">
	</table>
</div><script type="text/javascript">
					loadCSS("/posts/heatmaps/fig-heatmap.css");
				</script><script src="/posts/heatmaps/fig-heatmap.js"></script>

<section class="endmatter">
    
    <h4>Contributors</h4>
    <p><p>Acknowledgements for the bottom of the post go here.</p>
</p>
    

    <h4>Contact Details</h4>
    <p>
        Please direct media or other enquiries about this research to the
        <a
            href="https://mspgh.unimelb.edu.au/research-groups/centre-for-epidemiology-and-biostatistics-research/population-interventions"
            >Population Interventions Unit</a
        >
        at the following address.
    </p>
    <dl class="PI-contact">
        <dt>Email</dt>
        <dd>
            <a href="mailto:population-interventions@unimelb.edu.au"
                >population-interventions@unimelb.edu.au</a
            >
        </dd>
    </dl>
</section>

<script type="text/javascript">

    var views = {};

    function render(key, spec) {

    	// Add default graph config.

    	let defaultConfig = {
    		axis: {
    			labelFont: "Source Sans Pro, sans-serif",
    			titleFont: "Source Sans Pro, sans-serif",
    			titleFontSize: 20,
    			titleColor: "#012a58",
    			titleFontWeight: 400
    		},
    		legend: {
    			labelFont: "Source Sans Pro, sans-serif",
    			titleFont: "Source Sans Pro, sans-serif",
    			labelFontSize: 18,
    			labelColor: "#000000",
    			titlePadding: 15,
    			titleFontSize: 20,
    			titleColor: "#012a58",
    			symbolSize: 360,
    			labelSeparation: 10,
    			labelOffset: 10,
    			offset: 20,
    			titleFontWeight: 400,
    			layout: {
    				margin: 60
    			}
    		},
    		title: {
    			font: "Source Sans Pro, sans-serif",
    			subtitleFont: "Source Sans Pro, sans-serif",
    			anchor: "start",
    			color: "#012a58",
    			fontSize: 28,
    			fontWeight: 700,
    			subtitleColor: "#000000",
    			subtitleFontSize: "20",
    			subtitleFontWeight: "400",
    			subtitlePadding: 10,
    			offset: 20,
    			dx: 70
    		}
    	};
    	if (spec.hasOwnProperty('config')) {
    		spec.config.axis = { ...defaultConfig.axis, ...spec.config.axis };
    		spec.config.legend = { ...defaultConfig.legend, ...spec.config.legend };
    		spec.config.title = { ...defaultConfig.title, ...spec.config.title };
    	} else {
    		spec.config = defaultConfig;
    	}

    	// Create uom property if doesn't already exist.

    	if (!spec.hasOwnProperty('uom')) {
    		spec.uom = {};
    	}

    	// Make background white (if none already specified).

    	if (!spec.hasOwnProperty('background')) {
    		spec.background = "#ffffff";
    	}

    	// Blank out if 'coming soon'.

    	if (spec.uom.hasOwnProperty('comingSoon') & spec.uom['comingSoon']) {
    		spec.data.push({
    			name: "shades",
    			values: [ { "label": "Coming Soon" } ]
    		})

    		spec.marks = [
    			{
    				type: "rect",
    				from: { data: "shades" },
    				encode: {
    					update: {
    						x: { signal: "range('x')[0]" },
    						x2: { signal: "range('x')[1]" },
    						y: { signal: "range('y')[0]" },
    						y2: { signal: "range('y')[1]" },
    						strokeWidth: { value: 0 },
    						fill: { value: '#f2f5f9' }
    					}
    				}

    			},
    			{
    				type: "text",
    				from: { data: "shades" },
    				encode: {
    					update: {
    						x: { signal: "(range('x')[0] + range('x')[1]) / 2" },
    						y: { signal: "(range('y')[0] + range('y')[1]) / 2" },
    						text: { signal: "datum.label" },
    						baseline: { value: "middle" },
    						align: { value: "center" },
    						fill: { value: "#012a58" },
    						fontSize: { value: 20 },
    						fontWeight: { value: 'bold' }

    					}
    				}
    			}
    		]
    	}

    	// Specify renderer if not already specified.

    	if (!spec.uom.hasOwnProperty('renderer')) {
    		spec.uom.renderer = 'svg'; // Either 'svg' or 'canvas'.
    	}

    	// Set correct autosize mode.

    	if (!spec.hasOwnProperty("autosize")) {
    		spec.autosize = "fit";
    	}

    	// Define desired aspect ratio.

    	if (spec.hasOwnProperty('width') & spec.hasOwnProperty('height')) {
    		spec.uom.aspectRatio = spec.width / spec.height;
    	} else {
    		spec.uom.aspectRatio = 1.5;
    	}
    	delete spec.width;
    	delete spec.height;

    	// Define threshold width between two types of graph scaling.
    		// Above this width, the graph is re-rendered to fit the space available.
    		// (eg. text will stay its specified size)
    		// Below this width, the graph is simply scaled down to fit the space available.
    		// (eg. text will be smaller than the specified size)
    	if (!spec.uom.hasOwnProperty('minWidth')) {
    		spec.uom.minWidth = 800;
    	}

    	// Generate signals for specified toggles.

    	if (!spec.hasOwnProperty('signals')) {
    		spec.signals = [];
    	}
    	if (spec.uom.hasOwnProperty('toggleGroups')) {
    		for (let toggleGroup of spec.uom['toggleGroups']) {
    			for (let toggle of toggleGroup.toggles) {

    				let updateDefault, updateOnChange;
    				if (typeof(toggle.options[0].value) === "number") {
    					updateDefault = `${toggle.options.filter(d => d.default)[0].value}`;
    					updateOnChange = "toNumber(event.target.value)";
    				} else {
    					updateDefault = `'${toggle.options.filter(d => d.default)[0].value}'`;
    					updateOnChange = "event.target.value";
    				}

    				spec.signals.push({
    					name: toggle.signalName,
    					update: updateDefault,
    					on: [{
    						events: {
    							source: `#select-${key}-${toggle.signalName}`,
    							type: "change"
    						},
    						update: updateOnChange
    					}]
    				})
    			}
    		}
    	}

    	// Store reference to wrapper element.

    	spec.uom.container = document.querySelector(`#graph-container-${key}`);

    	// Create the view.

    	let width = Math.max(spec.uom.container.offsetWidth, spec.uom.minWidth);
    	vegaEmbed(
    		`#graph-container-${key}`,
    		spec,
    		opt = {
    			renderer: spec.uom.renderer,
    			// actions: key == 'PMSLT-HALY' ? false : {export: true, source: false, editor: false},
    			actions: false,
    			width: width,
    			height: width / spec.uom.aspectRatio
    		}
    	).then(function(result) {

    		views[key] = result.view;

    		// Make responsive.

    		if (spec.uom.renderer === 'canvas') {

    			spec.uom.resize = () => {
    				let width = Math.max(spec.uom.container.offsetWidth, spec.uom.minWidth);
    				views[key]
    					.width(width)
    					.height(width / spec.uom.aspectRatio)
    					.run();
    			};
    			window.addEventListener('resize', spec.uom.resize);

    		} else {

    			function removeWidthHeightAttributes() {
    				// Remove width/height attributes of Vega SVG and let viewBox handle the responsive behaviour.
    				let viewDom = spec.uom.container.firstElementChild;
    				viewDom.removeAttribute('width');
    				viewDom.removeAttribute('height');
    			}

    			spec.uom.resize = () => {

    				let width = Math.max(spec.uom.container.offsetWidth, spec.uom.minWidth);
    				views[key]
    					.width(width)
    					.height(width / spec.uom.aspectRatio)
    					.runAsync()
    					.then(vw => {
    						removeWidthHeightAttributes();
    					});

    			};
    			window.addEventListener('resize', spec.uom.resize);

    			removeWidthHeightAttributes();

    		}

    	}).catch(console.error);

    	return views[key];

    }

    // Render all graphs.

    for (let key of graphs) {

    	fetch('/posts/heatmaps/graph-' + key + '.json')
    		.then(res => res.json())
    		.then(spec => render(key, spec))
    		.catch(err => console.error(err));

    }

    // Reset select fields on page load (to avoid misleading browser-cached values).

    $( document ).ready(function() {
    	$('select').each( function() {
    		$(this).val( $(this).find("option[selected]").val() );
    	});
    });

    // Render KaTeX.

    
    	
    
</script>

<script>
    // Hanlde toggle close and open events

    $(".toggle-open").click(function (e) {
        var toggleBtn = $(this);
        var toggles = toggleBtn.closest("aside");
        if (toggles.length === 1) {
            toggles.toggleClass("collapsed");
        } else {
            var toggles = toggleBtn.siblings("aside");
            toggles.toggleClass("collapsed");
        }
        e.stopPropagation();
    });

    $(" aside ").click(function (e) {
        e.stopPropagation();
    });

    $(".toggle-close").click(function () {
        var toggleBtn = $(this);
        var toggles = toggleBtn.closest("aside");
        toggles.toggleClass("collapsed");
    });

    // $(document).click(function() {
    // 	$("aside").addClass("collapsed");
    // });
</script>

 
			</div>

			<div id="sitemap" role="navigation">
				<h2>Home</h2>
				<ul>
					
						<li>
							<a href="/">COVID-19 Pandemic</a>
							<div class="inner">
								<ul>
									
										<li>
											<a href="/pandemic-trade-offs">COVID-19 Pandemic Trade-offs: Version 1, March 2021</a>
										</li>
									
										<li>
											<a href="/pandemic-trade-offs-september-2021">COVID-19 Pandemic Trade-offs: Version 3, September 2021</a>
										</li>
									
								</ul>
							</div>
						</li>
					
					<li>
						<a href="https://mspgh.unimelb.edu.au/research-groups/centre-for-epidemiology-and-biostatistics-research/population-interventions" target="_blank" rel="noopener noreferrer">About the Population Interventions Unit</a>
					</li>
				</ul>
			</div>

		</div>
	</div>

</body>

</html>